addEventListener("message",({data:s})=>{let{playerImageData:n,targetImageData:t,tolerance:h}=s;if(!n||!t){postMessage(0);return}let c=D(n,t,50,h||15),e=isNaN(c)?0:c;postMessage(e)});function D(s,n,t,h){let c=s.length/4;if(c===0)return 0;let e=Math.sqrt(c),u=e,f=Math.floor(e/t),i=Math.floor(u/t),M=0,m=t*t;if(m===0)return 0;let p=Math.sqrt(3*255*255);for(let a=0;a<t;a++)for(let r=0;r<t;r++){let g=Math.floor(r*f+f/2),o=(Math.floor(a*i+i/2)*e+g)*4;if(o<0||o>=s.length)continue;let x=n[o],b=n[o+1],d=n[o+2],w=s[o],q=s[o+1],y=s[o+2],l=1-Math.sqrt(Math.pow(x-w,2)+Math.pow(b-q,2)+Math.pow(d-y,2))/p;l<0&&(l=0),M+=l}return M/m*100}
