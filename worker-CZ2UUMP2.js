addEventListener("message",({data:e})=>{if(!e){postMessage({score:0,details:{error:"No data"}});return}e.type==="COMPUTE_ANGULAR_ERROR"?postMessage(g(e.strokeAngles,e.symmetryAxes)):e.type==="COMPUTE_LCS_COMPLIANCE"?postMessage(h(e.requiredOrder,e.userOrder)):postMessage({score:0,details:{error:"Unknown type: "+e.type}})});function g(e,t){if(!e||e.length===0)return{score:1,details:{strokeCount:0}};let c=[];for(let i=0;i<t;i++)c.push(360/t*i);let o=e.map(i=>{let m=(i%360+360)%360;return c.reduce((u,a)=>{let l=Math.abs(m-a);return l>180&&(l=360-l),Math.min(u,l)},1/0)}),r=o.reduce((i,m)=>i+m,0)/o.length;return{score:+Math.max(0,Math.min(1,1-r/15)).toFixed(4),details:{strokeCount:e.length,meanErrorDeg:+r.toFixed(2),maxErrorDeg:+Math.max(...o).toFixed(2),symmetryAxes:t,targetErrorDeg:3}}}function h(e,t){if(!e||e.length===0)return{score:1,details:{lcsLength:0,requiredLength:0}};if(!t||t.length===0)return{score:0,details:{lcsLength:0,requiredLength:e.length}};let c=f(e,t),o=c/e.length,r=b(e,t);return{score:Math.max(0,+o.toFixed(4)),details:{lcsLength:c,requiredLength:e.length,userLength:t.length,backtracks:r,compliance:+(o*100).toFixed(1)}}}function f(e,t){let c=e.length,o=t.length,r=Array.from({length:c+1},()=>new Array(o+1).fill(0));for(let s=1;s<=c;s++)for(let n=1;n<=o;n++)e[s-1]===t[n-1]?r[s][n]=r[s-1][n-1]+1:r[s][n]=Math.max(r[s-1][n],r[s][n-1]);return r[c][o]}function b(e,t){let c=new Map;e.forEach((s,n)=>c.set(s,n));let o=0,r=-1;for(let s of t){let n=c.get(s);n!==void 0&&(n<r&&o++,r=Math.max(r,n))}return o}
