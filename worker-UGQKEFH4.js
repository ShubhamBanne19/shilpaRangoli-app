addEventListener("message",({data:n})=>{if(!n||n.type!=="COMPUTE_VELOCITY_CV"){postMessage({score:0,details:{error:"Invalid message type"}});return}let e=n.points;if(!e||e.length<3){postMessage({score:1,details:{pointCount:e?.length??0}});return}let r=h(e);postMessage(r)});function d(n,e,r,s){return Math.sqrt(Math.pow(r-n,2)+Math.pow(s-e,2))}function h(n){let e=[];for(let t=1;t<n.length;t++){let o=n[t].t-n[t-1].t;if(o<=0)continue;let l=d(n[t-1].x,n[t-1].y,n[t].x,n[t].y);e.push(l/o)}if(e.length<2)return{score:1,details:{velocitySamples:e.length}};let r=e.length,s=e.reduce((t,o)=>t+o,0)/r;if(s===0)return{score:1,details:{mean:0,cv:0}};let m=e.reduce((t,o)=>t+Math.pow(o-s,2),0)/r,u=Math.sqrt(m),i=u/s,c=Math.max(0,Math.min(1,1-i/.3)),a=e.filter(t=>t>s*3).length;return c=Math.max(0,c-a*.05),{score:+c.toFixed(4),details:{n:r,mean:+s.toFixed(4),stdDev:+u.toFixed(4),cv:+i.toFixed(4),spikeCount:a,targetCV:.2}}}
